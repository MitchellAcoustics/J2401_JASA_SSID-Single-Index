<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.4.553">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

    <meta name="author" content="Andrew Mitchell">
    <meta name="author" content="Francesco Aletta">
    <meta name="author" content="Tin Oberman">
    <meta name="author" content="Jian Kang">
    <meta name="dcterms.date" content="2024-04-26">
    <meta name="keywords" content="keyword1, keyword2">

    <title>SPI - Defining bespoke and archetypal context-dependent Soundscape Perception Indices</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "../index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      </head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> SPI - Defining bespoke and archetypal context-dependent Soundscape Perception Indices</h6>

            <a href="../notebooks/SingleIndex-Code.ipynb" class="btn btn-primary quarto-download-embed" download="SingleIndex-Code.ipynb">Download Notebook</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">SPI - Defining bespoke and archetypal context-dependent Soundscape Perception Indices</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliation</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Andrew Mitchell <a href="mailto:andrew.mitchell.18@ucl.ac.uk" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University College London
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Francesco Aletta <a href="mailto:f.aletta@ucl.ac.uk" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University College London
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Tin Oberman <a href="mailto:t.oberman@ucl.ac.uk" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        University College London
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Jian Kang <a href="mailto:j.kang@ucl.ac.uk" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
                <div>
            <div class="quarto-title-meta-heading">Published</div>
            <div class="quarto-title-meta-contents">
              <p class="date">April 26, 2024</p>
            </div>
          </div>
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>

    <div>
      <div class="abstract">
        <div class="block-title">Abstract</div>
        <p>The soundscape approach provides a basis for considering the holistic perception of sound environments, in context. While steady advancements have been made in methods for assessment and analysis, a gap exists for comparing soundscapes and quantifying improvements in the multi-dimensional perception of a soundscape. To this end, there is a need for the creation of single value indices to compare soundscape quality which incorporate context, aural diversity, and specific design goals for a given application. Just as a variety of decibel-based indices have been developed for various purposes (e.g.&nbsp;LAeq, LCeq, L90, Lden, etc.), the soundscape approach requires the ability to create novel indices for different uses, but which share a common language and understanding. We therefore propose a unified framework for creating both bespoke and standardised single index measures of soundscape perception based on the soundscape circumplex model, allowing for new metrics to be defined in the future. The implementation of this framework is demonstrated through the creation of a public spaced typology-based index using data collected under the SSID Protocol, which was designed specifically for the purpose of defining soundscape indices. Indices developed under this framework can enable a broader and more efficient application of the soundscape approach.</p>
      </div>
    </div>

    <div>
      <div class="keywords">
        <div class="block-title">Keywords</div>
        <p>keyword1, keyword2</p>
      </div>
    </div>

    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#import-libraries" id="toc-import-libraries" class="nav-link" data-scroll-target="#import-libraries">Import Libraries</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a>
  <ul class="collapse">
  <li><a href="#isocoordinate-calculation-according-to-aletta-et.-al.-2024" id="toc-isocoordinate-calculation-according-to-aletta-et.-al.-2024" class="nav-link" data-scroll-target="#isocoordinate-calculation-according-to-aletta-et.-al.-2024">ISOCoordinate calculation according to Aletta et. al.&nbsp;(2024)</a></li>
  </ul></li>
  <li><a href="#the-soundscape-perception-index-spi" id="toc-the-soundscape-perception-index-spi" class="nav-link" data-scroll-target="#the-soundscape-perception-index-spi">The Soundscape Perception Index (SPI)</a>
  <ul class="collapse">
  <li><a href="#note-distributions-in-the-circumplex" id="toc-note-distributions-in-the-circumplex" class="nav-link" data-scroll-target="#note-distributions-in-the-circumplex">Note: Distributions in the circumplex</a></li>
  </ul></li>
  <li><a href="#defining-multi-target-spis" id="toc-defining-multi-target-spis" class="nav-link" data-scroll-target="#defining-multi-target-spis">Defining multi-target SPIs</a></li>
  <li><a href="#defining-archetypes" id="toc-defining-archetypes" class="nav-link" data-scroll-target="#defining-archetypes">Defining archetypes</a>
  <ul class="collapse">
  <li><a href="#defining-an-overall-quality-rating" id="toc-defining-an-overall-quality-rating" class="nav-link" data-scroll-target="#defining-an-overall-quality-rating">Defining an overall quality rating</a></li>
  </ul></li>
  <li><a href="#mle-for-fitting-the-target-distribution" id="toc-mle-for-fitting-the-target-distribution" class="nav-link" data-scroll-target="#mle-for-fitting-the-target-distribution">MLE for fitting the target distribution</a>
  <ul class="collapse">
  <li><a href="#general-quality" id="toc-general-quality" class="nav-link" data-scroll-target="#general-quality">General Quality</a></li>
  <li><a href="#park-quality" id="toc-park-quality" class="nav-link" data-scroll-target="#park-quality">Park Quality</a></li>
  <li><a href="#not-park-quality" id="toc-not-park-quality" class="nav-link" data-scroll-target="#not-park-quality">Not Park Quality</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="setup" class="level1">
<h1>Setup</h1>
<section id="import-libraries" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries">Import Libraries</h2>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div id="cell-2" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:36:07.299759Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:36:05.487098Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> soundscapy <span class="im">as</span> sspy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utils</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpyskewnorm <span class="im">as</span> snpy</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> MultiSkewNorm <span class="im">import</span> MultiSkewNorm</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/mitch/Library/CloudStorage/OneDrive-UniversityCollegeLondon/_Fellowship/Papers - Drafts/J2401_JASA_SSID-Single-Index/.venv/lib/python3.11/site-packages/rpy2/robjects/numpy2ri.py:252: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  warnings.warn('The global conversion available with activate() '
/Users/mitch/Library/CloudStorage/OneDrive-UniversityCollegeLondon/_Fellowship/Papers - Drafts/J2401_JASA_SSID-Single-Index/.venv/lib/python3.11/site-packages/rpy2/robjects/pandas2ri.py:368: DeprecationWarning: The global conversion available with activate() is deprecated and will be removed in the next major release. Use a local converter.
  warnings.warn('The global conversion available with activate() '</code></pre>
</div>
</div></div>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<p>In addition to loading the latest version of the ISD, we also exclude a few samples that were identified as survey outliers. Most notably, this includes the samples at RegentsParkFields which were impacted by helicopter flyovers.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div id="cell-4" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:36:21.651402Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:36:07.300648Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load latest ISD dataset</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data = sspy.isd.load_zenodo()</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load latest ISD dataset</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>isd_file <span class="op">=</span> Path(<span class="st">"ISD v1.0 Data.csv"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(isd_file, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>data, excl_data <span class="op">=</span> sspy.isd.validate(data)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.query(<span class="st">"Language != 'cmn'"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude RegentsParkJapan outliers</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># excl_id = list(data.query("LocationID == 'RegentsParkJapan'").query("ISOEventful &gt; 0.72 | ISOEventful &lt; -0.5").index)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Excluded RegentsParkFields outliers</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># excl_id = excl_id + list(data.query("LocationID == 'RegentsParkFields' and ISOPleasant &lt; 0").index) # Helicopters</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>excl_id <span class="op">=</span> [<span class="dv">652</span>, <span class="dv">706</span>, <span class="dv">548</span>, <span class="dv">550</span>, <span class="dv">551</span>, <span class="dv">553</span>, <span class="dv">569</span>, <span class="dv">580</span>, <span class="dv">609</span>, <span class="dv">618</span>, <span class="dv">623</span>, <span class="dv">636</span>, <span class="dv">643</span>]</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>data.drop(excl_id, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Renaming PAQ columns.
Checking PAQ data quality.
Identified 109 samples to remove.
[6, 9, 13, 30, 32, 46, 190, 213, 229, 244, 296, 412, 413, 428, 464, 485, 655, 734, 739, 762, 766, 780, 1067, 1274, 1290, 1316, 1320, 1338, 1346, 1347, 1397, 1425, 1431, 1446, 1447, 1470, 1485, 1491, 1504, 1505, 1510, 1512, 1517, 1522, 1523, 1527, 1599, 1698, 1734, 1817, 1911, 1948, 2069, 2107, 2109, 2111, 2150, 2199, 2277, 2293, 2384, 2386, 2490, 2523, 2584, 2592, 2695, 2762, 2767, 2783, 2789, 2825, 2826, 2832, 2840, 2856, 2859, 2879, 2883, 2889, 2910, 2932, 2956, 2969, 3031, 3058, 3077, 3124, 3149, 3163, 3185, 3202, 3210, 3211, 3212, 3213, 3214, 3215, 3216, 3272, 3302, 3365, 3414, 3491, 3502, 3510, 3517, 3533, 3583]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LocationID</th>
<th data-quarto-table-cell-role="th">SessionID</th>
<th data-quarto-table-cell-role="th">GroupID</th>
<th data-quarto-table-cell-role="th">RecordID</th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">end_time</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">Language</th>
<th data-quarto-table-cell-role="th">Survey_Version</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">RA_cp90</th>
<th data-quarto-table-cell-role="th">RA_cp95</th>
<th data-quarto-table-cell-role="th">THD_THD</th>
<th data-quarto-table-cell-role="th">THD_Min</th>
<th data-quarto-table-cell-role="th">THD_Max</th>
<th data-quarto-table-cell-role="th">THD_L5</th>
<th data-quarto-table-cell-role="th">THD_L10</th>
<th data-quarto-table-cell-role="th">THD_L50</th>
<th data-quarto-table-cell-role="th">THD_L90</th>
<th data-quarto-table-cell-role="th">THD_L95</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CarloV</td>
<td>CarloV2</td>
<td>2CV12</td>
<td>1434</td>
<td>2019-05-16 18:46:00</td>
<td>2019-05-16 18:56:00</td>
<td>37.17685</td>
<td>-3.590392</td>
<td>eng</td>
<td>engISO2018</td>
<td>...</td>
<td>8.15</td>
<td>6.72</td>
<td>-0.09</td>
<td>-11.76</td>
<td>54.18</td>
<td>34.82</td>
<td>26.53</td>
<td>5.57</td>
<td>-9.00</td>
<td>-10.29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>CarloV</td>
<td>CarloV2</td>
<td>2CV12</td>
<td>1435</td>
<td>2019-05-16 18:46:00</td>
<td>2019-05-16 18:56:00</td>
<td>37.17685</td>
<td>-3.590392</td>
<td>eng</td>
<td>engISO2018</td>
<td>...</td>
<td>8.15</td>
<td>6.72</td>
<td>-0.09</td>
<td>-11.76</td>
<td>54.18</td>
<td>34.82</td>
<td>26.53</td>
<td>5.57</td>
<td>-9.00</td>
<td>-10.29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CarloV</td>
<td>CarloV2</td>
<td>2CV13</td>
<td>1430</td>
<td>2019-05-16 19:02:00</td>
<td>2019-05-16 19:12:00</td>
<td>37.17685</td>
<td>-3.590392</td>
<td>eng</td>
<td>engISO2018</td>
<td>...</td>
<td>5.00</td>
<td>3.91</td>
<td>-2.10</td>
<td>-19.32</td>
<td>72.52</td>
<td>32.33</td>
<td>24.52</td>
<td>0.25</td>
<td>-16.30</td>
<td>-17.33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>CarloV</td>
<td>CarloV2</td>
<td>2CV13</td>
<td>1431</td>
<td>2019-05-16 19:02:00</td>
<td>2019-05-16 19:12:00</td>
<td>37.17685</td>
<td>-3.590392</td>
<td>eng</td>
<td>engISO2018</td>
<td>...</td>
<td>5.00</td>
<td>3.91</td>
<td>-2.10</td>
<td>-19.32</td>
<td>72.52</td>
<td>32.33</td>
<td>24.52</td>
<td>0.25</td>
<td>-16.30</td>
<td>-17.33</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>CarloV</td>
<td>CarloV2</td>
<td>2CV13</td>
<td>1432</td>
<td>2019-05-16 19:02:00</td>
<td>2019-05-16 19:12:00</td>
<td>37.17685</td>
<td>-3.590392</td>
<td>eng</td>
<td>engISO2018</td>
<td>...</td>
<td>5.00</td>
<td>3.91</td>
<td>-2.10</td>
<td>-19.32</td>
<td>72.52</td>
<td>32.33</td>
<td>24.52</td>
<td>0.25</td>
<td>-16.30</td>
<td>-17.33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1693</td>
<td>Noorderplantsoen</td>
<td>Noorderplantsoen1</td>
<td>NP161</td>
<td>61</td>
<td>2020-03-11 12:42:00</td>
<td>2020-03-11 12:55:00</td>
<td>NaN</td>
<td>NaN</td>
<td>nld</td>
<td>nldSSIDv1</td>
<td>...</td>
<td>2.54</td>
<td>2.00</td>
<td>-3.17</td>
<td>-11.97</td>
<td>59.64</td>
<td>37.87</td>
<td>26.54</td>
<td>6.33</td>
<td>-9.79</td>
<td>-10.34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1694</td>
<td>Noorderplantsoen</td>
<td>Noorderplantsoen1</td>
<td>NP162</td>
<td>63</td>
<td>2020-03-11 12:39:00</td>
<td>2020-03-11 13:00:00</td>
<td>NaN</td>
<td>NaN</td>
<td>nld</td>
<td>nldSSIDv1</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1695</td>
<td>Noorderplantsoen</td>
<td>Noorderplantsoen1</td>
<td>NP162</td>
<td>62</td>
<td>2020-03-11 12:54:00</td>
<td>2020-03-11 12:58:00</td>
<td>NaN</td>
<td>NaN</td>
<td>nld</td>
<td>nldSSIDv1</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1696</td>
<td>Noorderplantsoen</td>
<td>Noorderplantsoen1</td>
<td>NP162</td>
<td>64</td>
<td>2020-03-11 12:56:00</td>
<td>2020-03-11 12:59:00</td>
<td>NaN</td>
<td>NaN</td>
<td>nld</td>
<td>nldSSIDv1</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1697</td>
<td>Noorderplantsoen</td>
<td>Noorderplantsoen1</td>
<td>NP163</td>
<td>70</td>
<td>2020-03-11 23:08:00</td>
<td>2020-03-11 23:18:00</td>
<td>NaN</td>
<td>NaN</td>
<td>nld</td>
<td>nldSSIDv1</td>
<td>...</td>
<td>2.58</td>
<td>1.99</td>
<td>-3.20</td>
<td>-9.67</td>
<td>57.99</td>
<td>35.54</td>
<td>29.32</td>
<td>8.86</td>
<td>-5.61</td>
<td>-6.71</td>
</tr>
</tbody>
</table>

<p>1638 rows × 142 columns</p>
</div>
</div>
</div>
</div></div>
<section id="isocoordinate-calculation-according-to-aletta-et.-al.-2024" class="level3">
<h3 class="anchored" data-anchor-id="isocoordinate-calculation-according-to-aletta-et.-al.-2024">ISOCoordinate calculation according to Aletta et. al.&nbsp;(2024)</h3>
<p>To move the 8-item PAQ responses into the 2-dimensional circumplex space, we use the projection method first presented in ISO 12913-3:2018. This projection method and its associated formulae were recently updated further in <span class="citation" data-cites="Aletta2024">(<a href="#ref-Aletta2024" role="doc-biblioref"><strong>Aletta2024?</strong></a>)</span> to include a correction for the language in which the survey was conducted. The formulae are as follows:</p>
<p><span class="math display">\[
% \begin{align*}
P_{ISO} = \frac{1}{\lambda_{pl}} \sum_{i=1}^{8} \cos \theta_i \cdot \sigma_i \\
E_{ISO} = \frac{1}{\lambda_{pl}} \sum_{i=1}^{8} \sin \theta_i \cdot \sigma_i
% \end{align*}
\]</span></p>
<p>where $_i$ is the response to the (i)th item of the PAQ. The resulting (x) and (y) values are then used to calculate the polar angle () and the radial distance (r) as follows:</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div id="cell-7" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:36:21.661999Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:36:21.653412Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> soundscapy.utils.parameters <span class="im">import</span> LANGUAGE_ANGLES, PAQ_IDS</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>LANGUAGE_ANGLES</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>{'eng': (0, 46, 94, 138, 177, 241, 275, 340),
 'arb': (0, 36, 45, 135, 167, 201, 242, 308),
 'cmn': (0, 18, 38, 154, 171, 196, 217, 318),
 'hrv': (0, 84, 93, 160, 173, 243, 273, 354),
 'nld': (0, 43, 111, 125, 174, 257, 307, 341),
 'deu': (0, 64, 97, 132, 182, 254, 282, 336),
 'ell': (0, 72, 86, 133, 161, 233, 267, 328),
 'ind': (0, 53, 104, 123, 139, 202, 284, 308),
 'ita': (0, 57, 104, 143, 170, 274, 285, 336),
 'spa': (0, 41, 103, 147, 174, 238, 279, 332),
 'swe': (0, 66, 87, 146, 175, 249, 275, 335),
 'tur': (0, 55, 97, 106, 157, 254, 289, 313)}</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell" data-execution_count="6">

<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>tab <span class="op">=</span> pd.DataFrame.from_dict(LANGUAGE_ANGLES, orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>PAQ_IDS)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div><div id="tbl-lang-angles" class="cell quarto-float anchored" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lang-angles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Language-specific angles for projection into the ISO 12913-3:2018 circumplex space.
</figcaption>
<div aria-describedby="tbl-lang-angles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<div>


<table class="dataframe do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PAQ1</th>
<th data-quarto-table-cell-role="th">PAQ2</th>
<th data-quarto-table-cell-role="th">PAQ3</th>
<th data-quarto-table-cell-role="th">PAQ4</th>
<th data-quarto-table-cell-role="th">PAQ5</th>
<th data-quarto-table-cell-role="th">PAQ6</th>
<th data-quarto-table-cell-role="th">PAQ7</th>
<th data-quarto-table-cell-role="th">PAQ8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">eng</td>
<td>0</td>
<td>46</td>
<td>94</td>
<td>138</td>
<td>177</td>
<td>241</td>
<td>275</td>
<td>340</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">arb</td>
<td>0</td>
<td>36</td>
<td>45</td>
<td>135</td>
<td>167</td>
<td>201</td>
<td>242</td>
<td>308</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">cmn</td>
<td>0</td>
<td>18</td>
<td>38</td>
<td>154</td>
<td>171</td>
<td>196</td>
<td>217</td>
<td>318</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">hrv</td>
<td>0</td>
<td>84</td>
<td>93</td>
<td>160</td>
<td>173</td>
<td>243</td>
<td>273</td>
<td>354</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">nld</td>
<td>0</td>
<td>43</td>
<td>111</td>
<td>125</td>
<td>174</td>
<td>257</td>
<td>307</td>
<td>341</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">deu</td>
<td>0</td>
<td>64</td>
<td>97</td>
<td>132</td>
<td>182</td>
<td>254</td>
<td>282</td>
<td>336</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ell</td>
<td>0</td>
<td>72</td>
<td>86</td>
<td>133</td>
<td>161</td>
<td>233</td>
<td>267</td>
<td>328</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ind</td>
<td>0</td>
<td>53</td>
<td>104</td>
<td>123</td>
<td>139</td>
<td>202</td>
<td>284</td>
<td>308</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ita</td>
<td>0</td>
<td>57</td>
<td>104</td>
<td>143</td>
<td>170</td>
<td>274</td>
<td>285</td>
<td>336</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">spa</td>
<td>0</td>
<td>41</td>
<td>103</td>
<td>147</td>
<td>174</td>
<td>238</td>
<td>279</td>
<td>332</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">swe</td>
<td>0</td>
<td>66</td>
<td>87</td>
<td>146</td>
<td>175</td>
<td>249</td>
<td>275</td>
<td>335</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">tur</td>
<td>0</td>
<td>55</td>
<td>97</td>
<td>106</td>
<td>157</td>
<td>254</td>
<td>289</td>
<td>313</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</figure>
</div></div></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-9" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:36:22.886321Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:36:21.659548Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> soundscapy.utils.parameters <span class="im">import</span> PAQ_IDS</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> data.iterrows():</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    lang <span class="op">=</span> row[<span class="st">"Language"</span>]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    angles <span class="op">=</span> LANGUAGE_ANGLES[lang]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    iso_pl, iso_ev <span class="op">=</span> (</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        sspy.surveys.adj_iso_pl(row[PAQ_IDS], angles, scale<span class="op">=</span><span class="dv">4</span>),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        sspy.surveys.adj_iso_ev(row[PAQ_IDS], angles, scale<span class="op">=</span><span class="dv">4</span>),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    data.loc[i, <span class="st">"ISOPleasant"</span>] <span class="op">=</span> iso_pl</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    data.loc[i, <span class="st">"ISOEventful"</span>] <span class="op">=</span> iso_ev</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">6</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">18</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (loc, ax) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(data.LocationID.unique(), axes.flatten())):</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    sspy.plotting.density(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        data.query(<span class="ss">f"LocationID == '</span><span class="sc">{</span>loc<span class="sc">}</span><span class="ss">'"</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>loc,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># hue='Language',</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-6-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="SingleIndex-Code_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-10" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting distribution density with empirical scatter</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">6</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">18</span>), sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (loc, ax) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(data.LocationID.unique(), axes.flatten())):</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    loc_msn <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    loc_msn.fit(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>data.query(<span class="ss">f"LocationID == '</span><span class="sc">{</span>loc<span class="sc">}</span><span class="ss">'"</span>)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    loc_msn.sample(<span class="dv">1000</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    loc_Y <span class="op">=</span> pd.DataFrame(loc_msn.sample_data, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    sspy.plotting.scatter(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        data.query(<span class="ss">f"LocationID == '</span><span class="sc">{</span>loc<span class="sc">}</span><span class="ss">'"</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>loc,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    sspy.plotting.density(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        loc_Y,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span>loc,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        incl_scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># hue='Language',</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-7-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="SingleIndex-Code_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
</section>
</section>
<section id="the-soundscape-perception-index-spi" class="level2">
<h2 class="anchored" data-anchor-id="the-soundscape-perception-index-spi">The Soundscape Perception Index (SPI)</h2>
<p>The SPI works by assessing the assessed (or calculated) distribution of soundscape responses against a target distribution. This target distribution represents the goal for the soundscape design. Since we consider a location’s soundscape perception to be the collective perception of its users, it is crucial that the target includes both the central tendency and the distribution.</p>
<section id="note-distributions-in-the-circumplex" class="level3">
<h3 class="anchored" data-anchor-id="note-distributions-in-the-circumplex">Note: Distributions in the circumplex</h3>
<p>We should begin by discussing how soundscape circumplex distributions are defined. The circumplex is defined by two axes: <span class="math inline">\(P_{ISO}\)</span> and <span class="math inline">\(E_{ISO}\)</span> which are limited to the range <span class="math inline">\([-1,1]\)</span>. Typically the distribution of collective perception of a soundscape is also not symmetrical, therefore making it a skewed distribution. A soundscape distribution is thus a two-dimensional truncated skew-normal distribution.</p>
<p>The skew-normal distribution is defined by three parameters: location, scale and shape. The location parameter defines the centre of the distribution, the scale parameter defines the spread of the distribution, and the shape parameter defines the skew of the distribution. The skew-normal distribution is defined as:</p>
<p><span class="math display">\[
f(x; a, \omega, \alpha) = \frac{2}{\omega} \phi \left( \frac{x-a}{\omega} \right) \Phi \left( \alpha \frac{x-a}{\omega} \right)
\]</span></p>
<p>where <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\Phi\)</span> are the standard normal probability density function and cumulative distribution function respectively. The skew-normal distribution is thus a generalisation of the normal distribution, with the shape parameter <span class="math inline">\(\alpha\)</span> defining the skew. A positive shape parameter results in a right-skewed distribution, and a negative shape parameter results in a left-skewed distribution.</p>
<p>Truncated skew-normal distribution: https://www-tandfonline-com.libproxy.ucl.ac.uk/doi/epdf/10.1080/03610910902936109?needAccess=true</p>
<p>To generate the truncated skew-normal distribution, we use rejection sampling. This is a method of generating a distribution by sampling from a simpler distribution and rejecting samples that do not fit the target distribution. In this case, we sample from a skew-normal distribution (<code>scipy.stats.skewnorm</code>) and reject samples that are outside of the range <span class="math inline">\([-1,1]\)</span>.</p>
<section id="example---calculating-the-moments-of-locations-distribution-and-generating-the-equivalent-distribution-using-rejection-sampling" class="level4">
<h4 class="anchored" data-anchor-id="example---calculating-the-moments-of-locations-distribution-and-generating-the-equivalent-distribution-using-rejection-sampling">Example - Calculating the moments of location’s distribution and generating the equivalent distribution using rejection sampling</h4>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-12" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:36:23.057441Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:36:22.892591Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>test_loc <span class="op">=</span> <span class="st">"SanMarco"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> sspy.isd.select_location_ids(data, test_loc)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>msn <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>msn.fit(data<span class="op">=</span>test_data[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>msn.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitted from data. n = 95
Direct Parameters:
xi:    [[0.065 0.629]]
omega: [[ 0.149 -0.064]
 [-0.064  0.101]]
alpha: [ 0.791 -0.767]


Centred Parameters:
mean:  [[0.283 0.451]]
sigma: [[ 0.102 -0.026]
 [-0.026  0.07 ]]
skew:  [ 0.136 -0.131]</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-fig-dist-example" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:36:24.997380Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:36:22.947404Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> msn.sample(<span class="dv">1000</span>, return_sample<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> pd.DataFrame(Y, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>D, p <span class="op">=</span> msn.ks2ds(test_data[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    test_data,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>axes[<span class="dv">0</span>],</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"full"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"a) Empirical data"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    Y, ax<span class="op">=</span>axes[<span class="dv">1</span>], density_type<span class="op">=</span><span class="st">"full"</span>, title<span class="op">=</span><span class="st">"b) MSN sampled distribution</span><span class="ch">\n</span><span class="st"> n sample = 1000"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-dist-example" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dist-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="SingleIndex-Code_files/figure-html/fig-dist-example-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3"><img src="SingleIndex-Code_files/figure-html/fig-dist-example-output-1.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dist-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Example of fitting and sampling from a multivariate skew-normal distribution for data from the Piazza San Marco location.
</figcaption>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-14" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:54:15.403051Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:54:14.093650Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Universal pleasant target</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># target = (</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     np.array([0.5, 0.0]),</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     np.array(</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         [[0.2, 0],</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#          [0, 0.2]]),</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     np.array([1, 0])</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># target = (</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     np.array([[1.03906292, 0.05335578]]),</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     np.array([[ 0.16551194, -0.04028515],</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#               [-0.04028515,  0.08754524]]),</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     np.array([-8.62309592,  1.07337721])</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>target.define_dp(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    xi<span class="op">=</span>np.array([<span class="fl">0.5</span>, <span class="fl">0.7</span>]),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    omega<span class="op">=</span>np.array([[<span class="fl">0.1</span>, <span class="fl">0.05</span>], [<span class="fl">0.05</span>, <span class="fl">0.1</span>]]),</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span>np.array([<span class="dv">0</span>, <span class="op">-</span><span class="dv">5</span>]),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>target.sample(<span class="dv">1000</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>target.sspy_plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-10-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="SingleIndex-Code_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-15" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    test_data, incl_scatter<span class="op">=</span><span class="va">True</span>, title<span class="op">=</span><span class="st">"San Marco</span><span class="ch">\n</span><span class="st">Empirical Density"</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame(target.sample_data, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    incl_scatter<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Target Density"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>axes[<span class="dv">1</span>],</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-11-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="SingleIndex-Code_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<p>Once the target is defined, we will generate a set of points that represent the target distribution.</p>
<p>Now that our target has been defined, we can calculate the SPI for a given set of responses. We will use the responses from Piazza San Marco in Venice, Italy, as an example.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [10]:</pre></div><div id="cell-18" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:54:19.320850Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:54:19.295186Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>test_spi <span class="op">=</span> target.spi(data.query(<span class="st">"LocationID == 'SanMarco'"</span>)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]])</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"San Marco SPI = </span><span class="sc">{</span>test_spi<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>San Marco SPI = 70</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [11]:</pre></div><div id="cell-19" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:54:21.367966Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:54:20.381396Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>target.sample_data[:, <span class="dv">0</span>],</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>target.sample_data[:, <span class="dv">1</span>],</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    incl_scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    sspy.isd.select_location_ids(data, <span class="st">"SanMarco"</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"Piazza San Marco</span><span class="ch">\n</span><span class="ss">SPI = </span><span class="sc">{</span>test_spi<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-13-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="SingleIndex-Code_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<p>We can compare this against another location, such as St Pancras Lock.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [12]:</pre></div><div id="cell-21" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:54:24.015026Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:54:22.957015Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>test_spi <span class="op">=</span> target.spi(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    sspy.isd.select_location_ids(data, <span class="st">"PancrasLock"</span>)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>target.sample_data[:, <span class="dv">0</span>],</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>target.sample_data[:, <span class="dv">1</span>],</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    incl_scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    sspy.isd.select_location_ids(data, <span class="st">"RegentsParkFields"</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"Pancras Lock</span><span class="ch">\n</span><span class="ss">SPI = </span><span class="sc">{</span>test_spi<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-14-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="SingleIndex-Code_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<p>SPI scores assessed against a target should not inherently be considered a measure of the quality of the soundscape - instead it reflects the degree to which the soundscape matches the target. A high SPI score does not necessarily mean that the soundscape is of high quality, but rather that the soundscape is of high quality <em>according to the target</em>.</p>
<p>The <span class="math inline">\(SPI_{bespoke}\)</span> thus provides a method for scoring and ranking the success of a soundscape design against the designer’s goals. Sticking with our defined target, we can assess all of the locations in the ISD and see which locations best match our target.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [13]:</pre></div><div id="cell-23" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:54:26.767584Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:54:26.096777Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>loc_bespoke <span class="op">=</span> {}</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> location <span class="kw">in</span> data.LocationID.unique():</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    loc_bespoke[location] <span class="op">=</span> target.spi(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        sspy.isd.select_location_ids(data, location)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>loc_bespoke <span class="op">=</span> pd.DataFrame.from_dict(loc_bespoke, orient<span class="op">=</span><span class="st">"index"</span>, columns<span class="op">=</span>[<span class="st">"SPI"</span>])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>loc_bespoke.sort_values(by<span class="op">=</span><span class="st">"SPI"</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>loc_bespoke</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SPI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SanMarco</td>
<td>70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TateModern</td>
<td>61</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Noorderplantsoen</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">StPaulsCross</td>
<td>59</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PancrasLock</td>
<td>54</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TorringtonSq</td>
<td>54</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">StPaulsRow</td>
<td>47</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RussellSq</td>
<td>46</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MiradorSanNicolas</td>
<td>46</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CamdenTown</td>
<td>43</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CarloV</td>
<td>39</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MonumentoGaribaldi</td>
<td>36</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MarchmontGarden</td>
<td>34</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PlazaBibRambla</td>
<td>34</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CampoPrincipe</td>
<td>32</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EustonTap</td>
<td>31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RegentsParkFields</td>
<td>27</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RegentsParkJapan</td>
<td>27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div></div>
<p>Assessed against a different target would result in a different ranking:</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [14]:</pre></div><div id="cell-25" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:50.073520Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:48.801134Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>target.define_dp(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    np.array([<span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>]),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    np.array([[<span class="fl">0.1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="fl">0.2</span>]]),</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    np.array([<span class="op">-</span><span class="fl">0.85</span>, <span class="fl">1.5</span>]),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>target.summary()</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>target.sample(n<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>target.sspy_plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitted from direct parameters.
Direct Parameters:
xi:    [-0.5 -0.5]
omega: [[0.1 0. ]
 [0.  0.2]]
alpha: [-0.85  1.5 ]


None</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-16-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="SingleIndex-Code_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [15]:</pre></div><div id="cell-26" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:53.923450Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:53.178742Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>loc_bespoke_2 <span class="op">=</span> {}</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> location <span class="kw">in</span> data.LocationID.unique():</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    loc_bespoke_2[location] <span class="op">=</span> target.spi(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        sspy.isd.select_location_ids(data, location)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>loc_bespoke_2 <span class="op">=</span> pd.DataFrame.from_dict(loc_bespoke_2, orient<span class="op">=</span><span class="st">"index"</span>, columns<span class="op">=</span>[<span class="st">"SPI"</span>])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>loc_bespoke_2.sort_values(by<span class="op">=</span><span class="st">"SPI"</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>loc_bespoke_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SPI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">EustonTap</td>
<td>33</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CamdenTown</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TorringtonSq</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MarchmontGarden</td>
<td>18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PlazaBibRambla</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PancrasLock</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">StPaulsRow</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">StPaulsCross</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CampoPrincipe</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SanMarco</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RussellSq</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CarloV</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TateModern</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RegentsParkJapan</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MiradorSanNicolas</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MonumentoGaribaldi</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Noorderplantsoen</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RegentsParkFields</td>
<td>2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [16]:</pre></div><div id="cell-27" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>target1 <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>target1.define_dp(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    np.array([<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>]), np.array([[<span class="fl">0.1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="fl">0.1</span>]]), np.array([<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>target1.sample()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>target2 <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>target2.define_dp(np.array([<span class="fl">0.5</span>, <span class="dv">0</span>]), np.array([[<span class="fl">0.1</span>, <span class="dv">0</span>], [<span class="dv">0</span>, <span class="fl">0.2</span>]]), np.array([<span class="dv">0</span>, <span class="dv">0</span>]))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>target2.sample()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>target_mix_y <span class="op">=</span> target1.sample_data <span class="op">+</span> target2.sample_data</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>target_mix_y <span class="op">=</span> pd.DataFrame(target_mix_y, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>sspy.plotting.jointplot(target_mix_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-18-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="SingleIndex-Code_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<hr>
</section>
</section>
</section>
<section id="defining-multi-target-spis" class="level2">
<h2 class="anchored" data-anchor-id="defining-multi-target-spis">Defining multi-target SPIs</h2>
<p>Above we have defined a single target to assess against. However, it is often useful to define multiple targets, for instance if different locations have different design goals. A simple version of this is clearly quite straightforward - simply define a table with a set of targets.</p>
<hr>
</section>
<section id="defining-archetypes" class="level2">
<h2 class="anchored" data-anchor-id="defining-archetypes">Defining archetypes</h2>
<p>Given the above method of defining and assessing against targets, users can define their target using whatever criteria they wish. However, a primary goal of this framework is to enable standard targets or sets of targets to be empirically defined.</p>
<p>However, it is often useful to define targets based on the architectural typology of the location. For example, a park may have a different target to a road.</p>
<section id="defining-an-overall-quality-rating" class="level3">
<h3 class="anchored" data-anchor-id="defining-an-overall-quality-rating">Defining an overall quality rating</h3>
<p>The overall quality rating is defined as the sum of the ‘Appropriateness’ and ‘Overall Rating’ scores. The overall quality rating is used to determine the overall quality of the soundscape, for that respondent.</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [17]:</pre></div><div id="cell-30" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:56.136629Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:55.792676Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"QualityRating"</span>] <span class="op">=</span> data.sss02 <span class="op">+</span> data.sss01</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data['QualityRating'] = data.Appropriate + data.sss04 + data.sss05</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data, x<span class="op">=</span><span class="st">"QualityRating"</span>, hue<span class="op">=</span><span class="st">"LocationID"</span>, multiple<span class="op">=</span><span class="st">"stack"</span>, discrete<span class="op">=</span><span class="va">True</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-19-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="SingleIndex-Code_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [18]:</pre></div><div id="cell-31" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:56.719205Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:56.700495Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data.LocationID.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array(['CarloV', 'SanMarco', 'PlazaBibRambla', 'CamdenTown', 'EustonTap',
       'Noorderplantsoen', 'MarchmontGarden', 'MonumentoGaribaldi',
       'TateModern', 'PancrasLock', 'TorringtonSq', 'RegentsParkFields',
       'RegentsParkJapan', 'RussellSq', 'StPaulsCross', 'StPaulsRow',
       'CampoPrincipe', 'MiradorSanNicolas'], dtype=object)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [19]:</pre></div><div id="cell-32" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:57.438360Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:57.419672Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define some architectural typologies</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>parks <span class="op">=</span> [</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RegentsParkFields"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RegentsParkJapan"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Noorderplantsoen"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"StPaulsCross"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MiradorSanNicolas"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RussellSq"</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LianhuanshanParkForest"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Noorderplantsoen"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PingshanPark"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ZhongshanPark"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>walkways <span class="op">=</span> [</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MarchmontGarden"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MonumentoGaribaldi"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PancrasLock"</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TateModern"</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LianhuanshanParkEntrance"</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>squares <span class="op">=</span> [</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PlazaBibRambla"</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SanMarco"</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"StPaulsRow"</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CampoPrincipe"</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CarloV"</span>,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DadongSquare"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OlympicSquare"</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ZhongshanSquare"</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>roads <span class="op">=</span> [</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CamdenTown"</span>,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EustonTap"</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TorringtonSq"</span>,</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PingshanStreet"</span>,</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [20]:</pre></div><div id="cell-33" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:58.519413Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:58.466139Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign architectural typologies to each data point</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>data.loc[data.LocationID.isin(parks), <span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Park"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>data.loc[data.LocationID.isin(walkways), <span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Walkway"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>data.loc[data.LocationID.isin(squares), <span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Square"</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>data.loc[data.LocationID.isin(roads), <span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Road"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"ArchiType"</span>] <span class="op">=</span> data[<span class="st">"ArchiType"</span>].astype(<span class="st">"category"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [21]:</pre></div><div id="cell-34" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:37:59.142358Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:59.057302Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify each point into a high or low soundscape quality</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"TypeSpecificQuality"</span>] <span class="op">=</span> <span class="st">"low"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># By using a quantile-based threshold, we are extracting the top x% of all responses from each typology</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">type</span> <span class="kw">in</span> data.ArchiType.unique():</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    type_threshold <span class="op">=</span> data.query(<span class="st">"ArchiType == @type"</span>)[<span class="st">"QualityRating"</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># type_threshold = type_threshold if type_threshold &gt; 8 else 8</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Threshold for </span><span class="sc">{</span><span class="bu">type</span><span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>type_threshold<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> data.query(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># "ArchiType == @type &amp; QualityRating &gt;= @type_threshold &amp; ISOPleasant &gt; 0", engine="python"</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># "ArchiType == @type &amp; QualityRating &gt;= @type_threshold", engine="python"</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ArchiType == @type &amp; QualityRating &gt;= 8.0"</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        engine<span class="op">=</span><span class="st">"python"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    ).index</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    data[<span class="st">"TypeSpecificQuality"</span>][rows] <span class="op">=</span> <span class="st">"high"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for Square is 9.0
Threshold for Road is 7.0
Threshold for Park is 9.0
Threshold for Walkway is 8.0</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [22]:</pre></div><div id="cell-35" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:38:01.330755Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:37:59.976377Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the high quality responses for each typology</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sspy.plotting.jointplot(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    data.query(<span class="st">"TypeSpecificQuality == 'high'"</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"ArchiType"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># incl_scatter=False,</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"High soundscape quality distributions by Architectural type"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-24-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="SingleIndex-Code_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [23]:</pre></div><div id="cell-36" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:38:02.445709Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:38:02.064017Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the distribution models for each type</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>m_parks <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>m_parks.fit(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data.query(<span class="st">"ArchiType == 'Park' &amp; TypeSpecificQuality == 'high'"</span>)[</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>m_parks.sample()</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>m_road <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>m_road.fit(</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data.query(<span class="st">"ArchiType == 'Road' &amp; TypeSpecificQuality == 'high'"</span>)[</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>m_road.sample()</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>m_walkway <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>m_walkway.fit(</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data.query(<span class="st">"ArchiType == 'Walkway' &amp; TypeSpecificQuality == 'high'"</span>)[</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>m_walkway.sample()</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>m_square <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>m_square.fit(</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data.query(<span class="st">"ArchiType == 'Square' &amp; TypeSpecificQuality == 'high'"</span>)[</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        [<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>m_square.sample()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [24]:</pre></div><div id="cell-37" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:38:05.539201Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:38:03.942405Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>y_parks <span class="op">=</span> pd.DataFrame(m_parks.sample_data, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>y_parks[<span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Park"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>y_road <span class="op">=</span> pd.DataFrame(m_road.sample_data, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>y_road[<span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Road"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>y_walkway <span class="op">=</span> pd.DataFrame(m_walkway.sample_data, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>y_walkway[<span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Walkway"</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>y_square <span class="op">=</span> pd.DataFrame(m_square.sample_data, columns<span class="op">=</span>[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>])</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>y_square[<span class="st">"ArchiType"</span>] <span class="op">=</span> <span class="st">"Square"</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>gend_df <span class="op">=</span> pd.concat([y_parks, y_road, y_walkway, y_square])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [25]:</pre></div><div id="cell-38" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:38:09.149877Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:38:06.240767Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sspy.plotting.jointplot(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    gend_df,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"ArchiType"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    incl_scatter<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Generated SSID distributions for 4 ArchiTypes"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-27-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="SingleIndex-Code_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [26]:</pre></div><div id="cell-39" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:38:25.018139Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:38:24.873314Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put it all together</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>loc <span class="op">=</span> <span class="st">"RegentsParkJapan"</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>architype <span class="op">=</span> <span class="st">"Park"</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> m_parks.spi(</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    data.query(<span class="st">"LocationID == @loc"</span>)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>loc<span class="sc">}</span><span class="ss"> SPI_</span><span class="sc">{</span>architype<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>res<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>loc <span class="op">=</span> <span class="st">"MarchmontGarden"</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>architype <span class="op">=</span> <span class="st">"Park"</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> m_parks.spi(</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    data.query(<span class="st">"LocationID == @loc"</span>)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>loc<span class="sc">}</span><span class="ss"> SSID_</span><span class="sc">{</span>architype<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>res<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>loc <span class="op">=</span> <span class="st">"EustonTap"</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>architype <span class="op">=</span> <span class="st">"Road"</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> m_road.spi(</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    data.query(<span class="st">"LocationID == @loc"</span>)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>loc<span class="sc">}</span><span class="ss"> SSID_</span><span class="sc">{</span>architype<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>res<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RegentsParkJapan SPI_Park: 84
MarchmontGarden SSID_Park: 63
EustonTap SSID_Road: 50</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [27]:</pre></div><div id="cell-40" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:38:46.750541Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:38:38.746019Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, axes = plt.subplots(4, 3, figsize=(12, 16))</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, loc in enumerate(data.LocationID.unique()):</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     if loc in data.LocationID.unique():</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         utils.spi_plot(data, gend_df, "Park", loc, ax=axes.flatten()[i])</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [28]:</pre></div><div id="cell-41" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:39:10.899942Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:39:06.797873Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, axes = plt.subplots(2, 2, figsize=(8, 8))</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, loc in enumerate(roads):</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     utils.spi_plot(data, gend_df, "Road", loc, ax=axes.flatten()[i])</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [29]:</pre></div><div id="cell-42" class="cell" data-executetime="{&quot;end_time&quot;:&quot;2024-02-02T22:39:30.426201Z&quot;,&quot;start_time&quot;:&quot;2024-02-02T22:39:16.978242Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, axes = plt.subplots(6, 3, figsize=(9, 18))</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for i, loc in enumerate(data.LocationID.unique()):</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     try:</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         archi_type = data.query("LocationID == @loc")["ArchiType"].iloc[0]</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         utils.spi_plot(data, gend_df, archi_type, loc, ax=axes.flatten()[i])</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     except:</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#         print(f"Error with {loc}")</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         pass</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.tight_layout()</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
</section>
<section id="mle-for-fitting-the-target-distribution" class="level2">
<h2 class="anchored" data-anchor-id="mle-for-fitting-the-target-distribution">MLE for fitting the target distribution</h2>
<p>Non-derivative/non-gradient based methods - evolutionary algorithms - NSGA-II - Simulated annealing -</p>
<p>Gradient-based approaches - Giorgious recommends avoiding these</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [30]:</pre></div><div id="cell-46" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>quality <span class="op">=</span> pd.DataFrame(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    data.groupby(<span class="st">"LocationID"</span>)[<span class="st">"QualityRating"</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>quality[<span class="st">"Rank"</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(quality) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>quality</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">QualityRating</th>
<th data-quarto-table-cell-role="th">Rank</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">LocationID</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">RegentsParkJapan</td>
<td>8.887640</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CampoPrincipe</td>
<td>8.545455</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PlazaBibRambla</td>
<td>8.500000</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">RegentsParkFields</td>
<td>8.392523</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CarloV</td>
<td>8.304348</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">MonumentoGaribaldi</td>
<td>8.156250</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">RussellSq</td>
<td>7.751724</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SanMarco</td>
<td>7.410526</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MiradorSanNicolas</td>
<td>7.392857</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TateModern</td>
<td>7.370861</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">MarchmontGarden</td>
<td>7.173077</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">StPaulsCross</td>
<td>7.090909</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TorringtonSq</td>
<td>6.938053</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">StPaulsRow</td>
<td>6.888889</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PancrasLock</td>
<td>6.619565</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CamdenTown</td>
<td>6.238095</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EustonTap</td>
<td>5.958333</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Noorderplantsoen</td>
<td>4.845361</td>
<td>18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [31]:</pre></div><div id="cell-47" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>quality <span class="op">=</span> pd.DataFrame(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    data.groupby(<span class="st">"LocationID"</span>)[<span class="st">"QualityRating"</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>quality[<span class="st">"Rank"</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(quality) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>quality <span class="op">=</span> quality.sort_index()[<span class="st">"Rank"</span>].copy()</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> target_success(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    target: MultiSkewNorm, ranking: pd.Series, data: pd.DataFrame, n_sample<span class="op">=</span><span class="dv">1000</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> scipy.stats <span class="im">import</span> spearmanr</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">len</span>(ranking) <span class="op">==</span> <span class="bu">len</span>(data.LocationID.unique())</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> target.sample_data <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>, <span class="st">"Target has not been sampled"</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    spis <span class="op">=</span> {}</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> location <span class="kw">in</span> data.LocationID.unique():</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># test_spi = utils.spi(</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     sspy.isd.select_location_ids(data, location)[["ISOPleasant", "ISOEventful"]],</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     target.sample_data,</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># )</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>        test_spi <span class="op">=</span> target.spi(</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>            sspy.isd.select_location_ids(data, location)[[<span class="st">"ISOPleasant"</span>, <span class="st">"ISOEventful"</span>]]</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>        spis[location] <span class="op">=</span> test_spi</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    spi_ranks <span class="op">=</span> pd.DataFrame.from_dict(spis, orient<span class="op">=</span><span class="st">"index"</span>, columns<span class="op">=</span>[<span class="st">"SPI"</span>])</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    spi_ranks.sort_values(by<span class="op">=</span><span class="st">"SPI"</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    spi_ranks[<span class="st">"Rank"</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(spi_ranks) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    ranks <span class="op">=</span> spi_ranks.sort_index()[<span class="st">"Rank"</span>]</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    spearman <span class="op">=</span> spearmanr(ranking, ranks)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>    weighted_spi <span class="op">=</span> <span class="bu">sum</span>([(<span class="dv">1</span> <span class="op">/</span> rank) <span class="op">*</span> spi <span class="cf">for</span> rank, spi <span class="kw">in</span> <span class="bu">zip</span>(ranks, spi_ranks[<span class="st">"SPI"</span>])])</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> spearman, weighted_spi, spi_ranks</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>tgt <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>tgt.define_dp(</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    np.array([<span class="fl">0.5</span>, <span class="fl">0.7</span>]),</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    np.array([[<span class="fl">0.1</span>, <span class="fl">0.05</span>], [<span class="fl">0.05</span>, <span class="fl">0.1</span>]]),</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>    np.array([<span class="dv">0</span>, <span class="op">-</span><span class="dv">5</span>]),</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>tgt.sample()</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>target_success(tgt, quality, data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>(SignificanceResult(statistic=-0.4984520123839009, pvalue=0.03525363586497097),
 138.96230721892485,
                     SPI  Rank
 SanMarco             74     1
 TateModern           63     2
 StPaulsCross         62     3
 PancrasLock          57     4
 TorringtonSq         56     5
 Noorderplantsoen     56     6
 StPaulsRow           49     7
 MiradorSanNicolas    49     8
 RussellSq            47     9
 CamdenTown           44    10
 CarloV               41    11
 MonumentoGaribaldi   39    12
 PlazaBibRambla       37    13
 MarchmontGarden      36    14
 EustonTap            33    15
 CampoPrincipe        33    16
 RegentsParkFields    28    17
 RegentsParkJapan     27    18)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [32]:</pre></div><div id="cell-48" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optimize_target</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>optimize_target.target_success(tgt, quality, data, <span class="st">"LocationID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>(SignificanceResult(statistic=-0.4674922600619195, pvalue=0.05043751945104438),
 138.98730721892488,
                     SPI  Rank
 SanMarco             74     1
 TateModern           63     2
 StPaulsCross         62     3
 PancrasLock          57     4
 TorringtonSq         56     5
 Noorderplantsoen     56     6
 StPaulsRow           49     7
 MiradorSanNicolas    49     8
 RussellSq            47     9
 CamdenTown           44    10
 CarloV               41    11
 MonumentoGaribaldi   39    12
 PlazaBibRambla       37    13
 MarchmontGarden      36    14
 CampoPrincipe        33    15
 EustonTap            33    16
 RegentsParkFields    28    17
 RegentsParkJapan     27    18,
 MultiSkewNorm(dp=Direct Parameters:
 xi:    [0.5 0.7]
 omega: [[0.1  0.05]
  [0.05 0.1 ]]
 alpha: [ 0 -5]))</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [33]:</pre></div><div id="cell-49" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Target</span><span class="ch">\n</span><span class="st">"</span>, target)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(target, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Target 1</span><span class="ch">\n</span><span class="st">"</span>, target1)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(target1, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Target 2</span><span class="ch">\n</span><span class="st">"</span>, target2)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(target2, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Parks</span><span class="ch">\n</span><span class="st">"</span>, m_parks)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(m_parks, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Road</span><span class="ch">\n</span><span class="st">"</span>, m_road)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(m_road, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Square</span><span class="ch">\n</span><span class="st">"</span>, m_square)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(m_square, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Walkway</span><span class="ch">\n</span><span class="st">"</span>, m_walkway)</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(m_walkway, quality, data)[<span class="dv">0</span>:<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Target
 MultiSkewNorm(dp=Direct Parameters:
xi:    [-0.5 -0.5]
omega: [[0.1 0. ]
 [0.  0.2]]
alpha: [-0.85  1.5 ])
(SignificanceResult(statistic=-0.42414860681114547, pvalue=0.0793889023946049), 53.749148400618985)

Target 1
 MultiSkewNorm(dp=Direct Parameters:
xi:    [-0.5  0.5]
omega: [[0.1 0. ]
 [0.  0.1]]
alpha: [0 0])
(SignificanceResult(statistic=-0.7069143446852425, pvalue=0.001036757704756384), 73.58191008338068)

Target 2
 MultiSkewNorm(dp=Direct Parameters:
xi:    [0.5 0. ]
omega: [[0.1 0. ]
 [0.  0.2]]
alpha: [0 0])
(SignificanceResult(statistic=0.5562435500515995, pvalue=0.016518403054404888), 223.52006718771426)

Parks
 MultiSkewNorm(dp=Direct Parameters:
xi:    [[1.039 0.053]]
omega: [[ 0.166 -0.04 ]
 [-0.04   0.088]]
alpha: [-8.623  1.073])
(SignificanceResult(statistic=0.6367389060887513, pvalue=0.004489848099432227), 190.83963079404256)

Road
 MultiSkewNorm(dp=Direct Parameters:
xi:    [[0.009 0.771]]
omega: [[ 0.142 -0.104]
 [-0.104  0.275]]
alpha: [ 3.99  -4.438])
(SignificanceResult(statistic=-0.6904024767801857, pvalue=0.0015160249841227721), 163.40694101649984)

Square
 MultiSkewNorm(dp=Direct Parameters:
xi:    [[ 0.865 -0.131]]
omega: [[ 0.17  -0.106]
 [-0.106  0.208]]
alpha: [-3.175  0.938])
(SignificanceResult(statistic=0.4055727554179567, pvalue=0.09495342479222932), 243.17349513231872)

Walkway
 MultiSkewNorm(dp=Direct Parameters:
xi:    [[0.932 0.129]]
omega: [[ 0.189 -0.033]
 [-0.033  0.094]]
alpha: [-3.12   0.274])
(SignificanceResult(statistic=0.37048503611971106, pvalue=0.13016560662863333), 216.03082162935107)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [34]:</pre></div><div id="cell-50" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>park_data <span class="op">=</span> data.query(<span class="st">"ArchiType == 'Park'"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>park_quality <span class="op">=</span> pd.DataFrame(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    park_data.groupby(<span class="st">"LocationID"</span>)[<span class="st">"QualityRating"</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>park_quality[<span class="st">"Rank"</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(park_quality) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>park_quality <span class="op">=</span> park_quality.sort_index()[<span class="st">"Rank"</span>].copy()</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Parks</span><span class="ch">\n</span><span class="st">"</span>, m_parks)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(m_parks, park_quality, park_data)[<span class="dv">0</span>:<span class="dv">2</span>])</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>square_data <span class="op">=</span> data.query(<span class="st">"ArchiType != 'Park'"</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>square_quality <span class="op">=</span> pd.DataFrame(</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    square_data.groupby(<span class="st">"LocationID"</span>)[<span class="st">"QualityRating"</span>]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>square_quality[<span class="st">"Rank"</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(square_quality) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>square_quality <span class="op">=</span> square_quality.sort_index()[<span class="st">"Rank"</span>].copy()</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Squares</span><span class="ch">\n</span><span class="st">"</span>, m_square)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(target_success(m_square, square_quality, square_data)[<span class="dv">0</span>:<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Parks
 MultiSkewNorm(dp=Direct Parameters:
xi:    [[1.039 0.053]]
omega: [[ 0.166 -0.04 ]
 [-0.04   0.088]]
alpha: [-8.623  1.073])
(SignificanceResult(statistic=0.8285714285714287, pvalue=0.04156268221574334), 155.3)

Squares
 MultiSkewNorm(dp=Direct Parameters:
xi:    [[ 0.865 -0.131]]
omega: [[ 0.17  -0.106]
 [-0.106  0.208]]
alpha: [-3.175  0.938])
(SignificanceResult(statistic=0.6573426573426573, pvalue=0.020185498509854103), 216.6029942279942)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [35]:</pre></div><div id="cell-51" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> ParameterGrid</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm_notebook <span class="im">as</span> tqdm</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _omega_is_pos_def(omega: np.ndarray) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">all</span>(np.linalg.eigvals(omega) <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _omega_is_symmetric(omega: np.ndarray) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.allclose(omega, omega.T)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"omega_0x"</span>: np.linspace(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">10</span>),</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"omega_0y"</span>: np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"omega_1x"</span>: np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"omega_1y"</span>: np.linspace(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">10</span>),</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> ParameterGrid(param_grid)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>grid_list <span class="op">=</span> <span class="bu">list</span>(grid)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>omegas <span class="op">=</span> []</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> params <span class="kw">in</span> tqdm(grid_list):</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    omega <span class="op">=</span> np.array([</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        [params[<span class="st">"omega_0x"</span>], params[<span class="st">"omega_0y"</span>]], </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>        [params[<span class="st">"omega_1x"</span>], params[<span class="st">"omega_1y"</span>]]</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> _omega_is_pos_def(omega) <span class="kw">and</span> _omega_is_symmetric(omega):</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>        omegas.append(omega)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ba999358faee4fa3912bab6a9801d017","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [36]:</pre></div><div id="cell-52" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(omegas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>187</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [37]:</pre></div><div id="cell-53" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> ParameterGrid</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm_notebook <span class="im">as</span> tqdm</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm_pathos <span class="im">import</span> tqdm_pathos</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> try_target(params, n<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    tgt <span class="op">=</span> MultiSkewNorm()</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Catch the errors raised by DirectParams.validate()</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If dp doesn't pass validation,xi don't append it to the list</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        tgt.define_dp(</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>            xi <span class="op">=</span> np.array([params[<span class="st">"xi_x"</span>], params[<span class="st">"xi_y"</span>]]),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>            omega <span class="op">=</span> params[<span class="st">"omega"</span>],</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>            alpha <span class="op">=</span> np.array([params[<span class="st">"alpha_x"</span>], params[<span class="st">"alpha_y"</span>]]),</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">AssertionError</span>:</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    tgt.sample(n<span class="op">=</span>n)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tgt</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"xi_x"</span>: np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"xi_y"</span>: np.linspace(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>),</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "omega_0x": np.linspace(0, 0.5, 10),</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "omega_0y": np.linspace(-1, 1, 10),</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "omega_1x": np.linspace(-1, 1, 10),</span></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "omega_1y": np.linspace(0, 0.5, 10),</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"omega"</span>: omegas,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alpha_x"</span>: np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alpha_y"</span>: np.linspace(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>grid <span class="op">=</span> ParameterGrid(param_grid)</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>grid_list <span class="op">=</span> <span class="bu">list</span>(grid)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="co"># targets = []</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="co"># for params in tqdm(grid_list):</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     tgt = try_target(params, n=250)</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     if tgt is not None:</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="co">#         targets.append(tgt)</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>targets <span class="op">=</span> tqdm_pathos.<span class="bu">map</span>(try_target, grid_list)</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(targets))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"8881449f043e4f1785e0a4a0dcd0e5c4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>116875</code></pre>
</div>
</div></div>
<section id="general-quality" class="level3">
<h3 class="anchored" data-anchor-id="general-quality">General Quality</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [53]:</pre></div><div id="cell-55" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># r_res = np.array([])</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># wspi_res = np.array([])</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ranks_res = []</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for target in tqdm(targets):</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     res = target_success(target, quality, data)</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     r_res = np.append(r_res, res[0][0])</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     wspi_res = np.append(wspi_res, res[1])</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     ranks_res.append(res[2])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [38]:</pre></div><div id="cell-56" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>r_res, wspi_res, targets_res <span class="op">=</span> optimize_target.run_grid(targets, quality, data, <span class="st">"LocationID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7f93df4a2c9641a495e32a6ab164bd46","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [39]:</pre></div><div id="cell-57" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plt.plot(r_res, wspi_res, <span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-42-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="SingleIndex-Code_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [40]:</pre></div><div id="cell-58" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>comb_res <span class="op">=</span> [r_res[i] <span class="op">*</span> wspi_res[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(r_res))]</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>best_target <span class="op">=</span> targets[np.argmax(comb_res)]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r_res[np.argmax(comb_res)])</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_target.summary())</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>best_target.sspy_plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7894736842105263
Fitted from direct parameters.
Direct Parameters:
xi:    [ 0.5 -0.5]
omega: [[0.056 0.111]
 [0.111 0.444]]
alpha: [1. 2.]


None
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-43-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="SingleIndex-Code_files/figure-html/cell-43-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [44]:</pre></div><div id="cell-59" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>best_target.sample_data[:, <span class="dv">0</span>], y<span class="op">=</span>best_target.sample_data[:, <span class="dv">1</span>], ax<span class="op">=</span>ax, incl_scatter<span class="op">=</span><span class="va">False</span>, density_type<span class="op">=</span><span class="st">"full"</span>, title<span class="op">=</span><span class="st">""</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    sspy.isd.select_location_ids(data, <span class="st">"CarloV"</span>),</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"CarloV</span><span class="ch">\n</span><span class="ss">SPI = </span><span class="sc">{</span>best_target<span class="sc">.</span>spi(sspy.isd.select_location_ids(data, <span class="st">'CarloV'</span>)[[<span class="st">'ISOPleasant'</span>, <span class="st">'ISOEventful'</span>]])<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-44-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="SingleIndex-Code_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [42]:</pre></div><div id="cell-60" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>optimize_target.target_success(best_target, quality, data, <span class="st">"LocationID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>(SignificanceResult(statistic=0.7894736842105263, pvalue=9.781072774060512e-05),
 210.24482037570274,
                     SPI  Rank
 CarloV               78     1
 PlazaBibRambla       75     2
 CampoPrincipe        74     3
 RussellSq            72     4
 MonumentoGaribaldi   70     5
 RegentsParkFields    67     6
 RegentsParkJapan     62     7
 MarchmontGarden      61     8
 PancrasLock          57     9
 StPaulsCross         55    10
 TateModern           50    11
 MiradorSanNicolas    50    12
 StPaulsRow           47    13
 Noorderplantsoen     44    14
 SanMarco             32    15
 TorringtonSq         31    16
 CamdenTown           15    17
 EustonTap            10    18,
 MultiSkewNorm(dp=Direct Parameters:
 xi:    [ 0.5 -0.5]
 omega: [[0.056 0.111]
  [0.111 0.444]]
 alpha: [1. 2.]))</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [43]:</pre></div><div id="cell-61" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>quality.sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>LocationID
RegentsParkJapan       1
CampoPrincipe          2
PlazaBibRambla         3
RegentsParkFields      4
CarloV                 5
MonumentoGaribaldi     6
RussellSq              7
SanMarco               8
MiradorSanNicolas      9
TateModern            10
MarchmontGarden       11
StPaulsCross          12
TorringtonSq          13
StPaulsRow            14
PancrasLock           15
CamdenTown            16
EustonTap             17
Noorderplantsoen      18
Name: Rank, dtype: int64</code></pre>
</div>
</div></div>
</section>
<section id="park-quality" class="level3">
<h3 class="anchored" data-anchor-id="park-quality">Park Quality</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [46]:</pre></div><div id="cell-63" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>r_res, wspi_res, targets_res <span class="op">=</span> optimize_target.run_grid(targets, park_quality, data, <span class="st">"LocationID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6036f83ae3dc4766814568cd23edbb6f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [47]:</pre></div><div id="cell-64" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>plt.plot(r_res, wspi_res, <span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-48-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="SingleIndex-Code_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [50]:</pre></div><div id="cell-65" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>comb_res <span class="op">=</span> [r_res[i] <span class="op">*</span> wspi_res[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(r_res))]</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>best_target <span class="op">=</span> targets[np.argmax(comb_res)]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r_res[np.argmax(comb_res)])</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_target.summary())</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>best_target.sspy_plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.942857142857143
Fitted from direct parameters.
Direct Parameters:
xi:    [0.5 0.5]
omega: [[ 0.278 -0.111]
 [-0.111  0.278]]
alpha: [ 1. -2.]


None
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-49-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="SingleIndex-Code_files/figure-html/cell-49-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [51]:</pre></div><div id="cell-66" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>best_target.sample_data[:, <span class="dv">0</span>], y<span class="op">=</span>best_target.sample_data[:, <span class="dv">1</span>], ax<span class="op">=</span>ax, incl_scatter<span class="op">=</span><span class="va">False</span>, density_type<span class="op">=</span><span class="st">"full"</span>, title<span class="op">=</span><span class="st">""</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    sspy.isd.select_location_ids(data, <span class="st">"CarloV"</span>),</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"CarloV</span><span class="ch">\n</span><span class="ss">SPI = </span><span class="sc">{</span>best_target<span class="sc">.</span>spi(sspy.isd.select_location_ids(data, <span class="st">'CarloV'</span>)[[<span class="st">'ISOPleasant'</span>, <span class="st">'ISOEventful'</span>]])<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-50-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="SingleIndex-Code_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="not-park-quality" class="level3">
<h3 class="anchored" data-anchor-id="not-park-quality">Not Park Quality</h3>
<div class="cell-container"><div class="cell-decorator"><pre>In [52]:</pre></div><div id="cell-68" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>r_res, wspi_res, targets_res <span class="op">=</span> optimize_target.run_grid(targets, square_quality, square_data, <span class="st">"LocationID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b22e1265b29544e9ad5afb01cfa0df19","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [53]:</pre></div><div id="cell-69" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plt.plot(r_res, wspi_res, <span class="st">"o"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-52-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="SingleIndex-Code_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [54]:</pre></div><div id="cell-70" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>comb_res <span class="op">=</span> [r_res[i] <span class="op">*</span> wspi_res[i] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(r_res))]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>best_target <span class="op">=</span> targets[np.argmax(comb_res)]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r_res[np.argmax(comb_res)])</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(best_target.summary())</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>best_target.sspy_plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.8601398601398602
Fitted from direct parameters.
Direct Parameters:
xi:    [0.5 0. ]
omega: [[ 0.056 -0.111]
 [-0.111  0.444]]
alpha: [1. 1.]


None
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-53-output-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="SingleIndex-Code_files/figure-html/cell-53-output-2.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [58]:</pre></div><div id="cell-71" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>best_target.sample_data[:, <span class="dv">0</span>], y<span class="op">=</span>best_target.sample_data[:, <span class="dv">1</span>], ax<span class="op">=</span>ax, incl_scatter<span class="op">=</span><span class="va">False</span>, density_type<span class="op">=</span><span class="st">"full"</span>, title<span class="op">=</span><span class="st">""</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>sspy.plotting.density(</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    sspy.isd.select_location_ids(data, <span class="st">"CampoPrincipe"</span>),</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    density_type<span class="op">=</span><span class="st">"simple"</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="ss">f"Campo Principe</span><span class="ch">\n</span><span class="ss">SPI = </span><span class="sc">{</span>best_target<span class="sc">.</span>spi(sspy.isd.select_location_ids(data, <span class="st">'CampoPrincipe'</span>)[[<span class="st">'ISOPleasant'</span>, <span class="st">'ISOEventful'</span>]])<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div class="">
<figure class="figure">
<p class=""><a href="SingleIndex-Code_files/figure-html/cell-54-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="SingleIndex-Code_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [56]:</pre></div><div id="cell-72" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>target_success(best_target, square_quality, square_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>(SignificanceResult(statistic=0.8601398601398602, pvalue=0.0003316683391269209),
 190.0364357864358,
                     SPI  Rank
 CampoPrincipe        75     1
 PlazaBibRambla       72     2
 CarloV               70     3
 MarchmontGarden      67     4
 MonumentoGaribaldi   64     5
 TateModern           63     6
 PancrasLock          62     7
 StPaulsRow           58     8
 SanMarco             49     9
 TorringtonSq         44    10
 CamdenTown           21    11
 EustonTap            14    12)</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [57]:</pre></div><div id="cell-73" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>square_quality.sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>LocationID
CampoPrincipe          1
PlazaBibRambla         2
CarloV                 3
MonumentoGaribaldi     4
SanMarco               5
TateModern             6
MarchmontGarden        7
TorringtonSq           8
StPaulsRow             9
PancrasLock           10
CamdenTown            11
EustonTap             12
Name: Rank, dtype: int64</code></pre>
</div>
</div></div>
<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-3">Figure&nbsp;1: Example of fitting and sampling from a multivariate skew-normal distribution for data from the Piazza San Marco location.</span>
</div>
</section>
</section>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"descPosition":"bottom","closeEffect":"zoom","openEffect":"zoom","selector":".lightbox","loop":false});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script> 
  
</body></html>